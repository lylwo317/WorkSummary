# 减少锁粒度，并防止线程持有锁时做耗时操作

## 现象
当连接相机时候，界面卡顿

## 分析
发现主线程和子线程都会竞争同一个锁（这个锁是一个ArrayList集合），而子线程在持有锁的时候会遍历该ArrayList集合并做耗时的IO操作。而且锁的粒度过大，基本是以函数为单位。

## 解决
1. 首先将锁的粒度减小，让主线程有更多的机会获取锁。
2. 在子线程做耗时操作前，拷贝一个ArrayList的副本，并让该子线程对副本进行遍历。这样在做耗时操作时就不需要持有锁了，（ArrayList锁），也就不会出现长时间持有锁的情况

